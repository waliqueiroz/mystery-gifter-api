# üéÅ Mystery Gifter API

[![Go Version](https://img.shields.io/badge/Go-1.25.1-blue.svg)](https://golang.org/)
[![Fiber](https://img.shields.io/badge/Fiber-v2.52.6-00ADD8.svg)](https://gofiber.io/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-Latest-336791.svg)](https://postgresql.org/)
[![Docker](https://img.shields.io/badge/Docker-Supported-2496ED.svg)](https://docker.com/)
[![Swagger](https://img.shields.io/badge/Swagger-Documented-85EA2D.svg)](http://localhost:8080/swagger/)

Uma API REST moderna desenvolvida em Go para gerenciar grupos de **Secret Santa** (Amigo Secreto). Permite criar grupos, adicionar participantes e gerar aleatoriamente os pares de quem presenteia quem.

## üìã √çndice

- [Caracter√≠sticas](#-caracter√≠sticas)
- [Tecnologias](#-tecnologias)
- [Arquitetura](#-arquitetura)
- [Pr√©-requisitos](#-pr√©-requisitos)
- [Instala√ß√£o e Execu√ß√£o](#-instala√ß√£o-e-execu√ß√£o)
- [Configura√ß√£o](#-configura√ß√£o)
- [Documenta√ß√£o da API](#-documenta√ß√£o-da-api)
- [Endpoints](#-endpoints)
- [Exemplos de Uso](#-exemplos-de-uso)
- [Desenvolvimento](#-desenvolvimento)
- [Testes](#-testes)
- [Estrutura do Projeto](#-estrutura-do-projeto)
- [Contribui√ß√£o](#-contribui√ß√£o)
- [Licen√ßa](#-licen√ßa)

## ‚ú® Caracter√≠sticas

- üéØ **Gest√£o Completa de Grupos**: Criar, gerenciar e arquivar grupos de Secret Santa
- üë• **Sistema de Usu√°rios**: Cadastro, autentica√ß√£o e busca de usu√°rios
- üé≤ **Gera√ß√£o Aleat√≥ria de Matches**: Algoritmo seguro para criar pares de presenteio
- üîê **Autentica√ß√£o JWT**: Sistema seguro de autentica√ß√£o com tokens
- üìä **Busca e Filtros**: Sistema avan√ßado de busca com pagina√ß√£o
- üèóÔ∏è **Arquitetura Limpa**: Implementa√ß√£o seguindo Clean Architecture
- üß™ **Cobertura de Testes**: Testes unit√°rios abrangentes
- üìö **Documenta√ß√£o Swagger**: API completamente documentada
- üê≥ **Docker Ready**: Containeriza√ß√£o completa para desenvolvimento e produ√ß√£o

## üõ†Ô∏è Tecnologias

### Backend
- **[Go 1.25.1](https://golang.org/)** - Linguagem principal
- **[Fiber v2.52.6](https://gofiber.io/)** - Framework web de alta performance
- **[PostgreSQL](https://postgresql.org/)** - Banco de dados relacional
- **[JWT](https://jwt.io/)** - Autentica√ß√£o baseada em tokens
- **[BCrypt](https://en.wikipedia.org/wiki/Bcrypt)** - Hash de senhas seguro

### Ferramentas de Desenvolvimento
- **[Docker](https://docker.com/)** - Containeriza√ß√£o
- **[Swagger/OpenAPI](https://swagger.io/)** - Documenta√ß√£o da API
- **[Testify](https://github.com/stretchr/testify)** - Framework de testes
- **[Mock](https://github.com/uber-go/mock)** - Gera√ß√£o de mocks
- **[Migrate](https://github.com/golang-migrate/migrate)** - Migra√ß√µes de banco

## üèóÔ∏è Arquitetura

O projeto segue os princ√≠pios da **Clean Architecture** (Arquitetura Hexagonal), garantindo:

- **Separa√ß√£o de responsabilidades** clara
- **Testabilidade** alta
- **Flexibilidade** para mudan√ßas
- **Manutenibilidade** otimizada

```
üìÅ internal/
‚îú‚îÄ‚îÄ üéØ domain/          # Entidades e regras de neg√≥cio
‚îú‚îÄ‚îÄ üîß application/      # Casos de uso e servi√ßos
‚îî‚îÄ‚îÄ üèóÔ∏è infra/           # Infraestrutura e adaptadores
    ‚îú‚îÄ‚îÄ config/         # Configura√ß√µes
    ‚îú‚îÄ‚îÄ entrypoint/     # Controllers REST e rotas
    ‚îî‚îÄ‚îÄ outgoing/        # Reposit√≥rios e servi√ßos externos
```

## üìã Pr√©-requisitos

- **[Docker](https://docs.docker.com/get-docker/)** (vers√£o 20.10+)
- **[Docker Compose](https://docs.docker.com/compose/install/)** (vers√£o 2.0+)

> üí° **Dica**: Para desenvolvimento local, voc√™ tamb√©m pode usar Go 1.25.1+ instalado diretamente no sistema.

## üöÄ Instala√ß√£o e Execu√ß√£o

### 1. Clone o reposit√≥rio

```bash
git clone https://github.com/waliqueiroz/mystery-gifter-api.git
cd mystery-gifter-api
```

### 2. Configure as vari√°veis de ambiente

Copie o arquivo de exemplo e configure suas vari√°veis:

```bash
cp .env.example .env
```

Edite o arquivo `.env` com suas configura√ß√µes:

```bash
# Configura√ß√µes do Banco de Dados
DB_HOST=db
DB_PORT=5432
DB_DATABASE=mystery_gifter
DB_USERNAME=postgres
DB_PASSWORD=postgres

# Configura√ß√µes de Autentica√ß√£o
AUTH_SECRET_KEY=your-super-secret-key-change-in-production-minimum-32-chars
AUTH_SESSION_DURATION=24h
```

> ‚ö†Ô∏è **Importante**: Altere a `AUTH_SECRET_KEY` para uma chave segura em produ√ß√£o!

### 3. Execute com Docker Compose

```bash
# Desenvolvimento (com rebuild autom√°tico)
docker-compose up --build

# Executar em background
docker-compose up -d --build

# Apenas produ√ß√£o
docker-compose up -d
```

### 4. Verifique se est√° funcionando

- **API**: http://localhost:8080
- **Banco de Dados**: localhost:5432

### 5. Gerar e visualizar a documenta√ß√£o Swagger

A documenta√ß√£o Swagger precisa ser gerada e servida separadamente:

```bash
# Gerar a documenta√ß√£o Swagger
make generate-docs

# Servir a documenta√ß√£o (em uma nova aba do terminal)
make serve-docs
```

Ap√≥s executar `make serve-docs`, acesse:
- **Documenta√ß√£o Swagger**: http://localhost:8081

## ‚öôÔ∏è Configura√ß√£o

### Vari√°veis de Ambiente

| Vari√°vel | Descri√ß√£o | Padr√£o | Obrigat√≥ria |
|----------|-----------|--------|-------------|
| `DB_HOST` | Host do banco de dados | `db` | ‚úÖ |
| `DB_PORT` | Porta do banco de dados | `5432` | ‚úÖ |
| `DB_DATABASE` | Nome do banco | `mystery_gifter_db` | ‚úÖ |
| `DB_USERNAME` | Usu√°rio do banco | `postgres` | ‚úÖ |
| `DB_PASSWORD` | Senha do banco | - | ‚úÖ |
| `AUTH_SECRET_KEY` | Chave secreta para JWT | - | ‚úÖ |
| `AUTH_SESSION_DURATION` | Dura√ß√£o da sess√£o | `24h` (apenas no Docker) | ‚úÖ |

> ‚ö†Ô∏è **Nota**: `AUTH_SESSION_DURATION` √© obrigat√≥ria. No Docker Compose h√° um valor padr√£o (`24h`), mas para execu√ß√£o local voc√™ deve defini-la explicitamente.

### Estados dos Grupos

- **`OPEN`**: Aceitando novos usu√°rios
- **`MATCHED`**: Matches j√° gerados
- **`ARCHIVED`**: Grupo arquivado (n√£o pode ser reaberto)

## üìö Documenta√ß√£o da API

A API est√° completamente documentada com **Swagger/OpenAPI**. Para visualizar a documenta√ß√£o:

### Gerar e Servir a Documenta√ß√£o

```bash
# 1. Gerar a documenta√ß√£o a partir dos coment√°rios no c√≥digo
make generate-docs

# 2. Servir a documenta√ß√£o interativa
make serve-docs
```

### Acessar a Documenta√ß√£o

Ap√≥s executar `make serve-docs`, acesse:
- **Swagger UI**: http://localhost:8081
- **Especifica√ß√£o OpenAPI**: http://localhost:8081/swagger.json

> üí° **Dica**: A documenta√ß√£o √© gerada automaticamente a partir dos coment√°rios `swagger:` no c√≥digo. Sempre atualize os coment√°rios quando modificar a API.

## üîó Endpoints

### üîê Autentica√ß√£o
- `POST /api/v1/login` - Login e obten√ß√£o de token JWT

### üë• Usu√°rios
- `POST /api/v1/users` - Criar novo usu√°rio
- `GET /api/v1/users` - Buscar usu√°rios (com filtros e pagina√ß√£o)
- `GET /api/v1/users/{id}` - Obter usu√°rio por ID

### üéÅ Grupos
- `GET /api/v1/groups` - Buscar grupos (com filtros e pagina√ß√£o)
- `POST /api/v1/groups` - Criar novo grupo
- `GET /api/v1/groups/{id}` - Obter grupo por ID
- `POST /api/v1/groups/{id}/users` - Adicionar usu√°rio ao grupo
- `DELETE /api/v1/groups/{id}/users/{userId}` - Remover usu√°rio do grupo
- `POST /api/v1/groups/{id}/matches` - Gerar matches aleat√≥rios
- `GET /api/v1/groups/{id}/matches/user` - Obter match do usu√°rio logado
- `POST /api/v1/groups/{id}/reopen` - Reabrir grupo
- `POST /api/v1/groups/{id}/archive` - Arquivar grupo

> üîí **Nota**: Todos os endpoints exceto `POST /api/v1/users` e `POST /api/v1/login` requerem autentica√ß√£o JWT.

## üí° Exemplos de Uso

### 1. Criar um usu√°rio

```bash
curl -X POST http://localhost:8080/api/v1/users \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Jo√£o",
    "surname": "Silva",
    "email": "joao@example.com",
    "password": "minhasenha123",
    "password_confirm": "minhasenha123"
  }'
```

### 2. Fazer login

```bash
curl -X POST http://localhost:8080/api/v1/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "joao@example.com",
    "password": "minhasenha123"
  }'
```

### 3. Criar um grupo (com token JWT)

```bash
curl -X POST http://localhost:8080/api/v1/groups \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer SEU_JWT_TOKEN_AQUI" \
  -d '{
    "name": "Secret Santa 2024"
  }'
```

### 4. Gerar matches

```bash
curl -X POST http://localhost:8080/api/v1/groups/{group_id}/matches \
  -H "Authorization: Bearer SEU_JWT_TOKEN_AQUI"
```

## üõ†Ô∏è Desenvolvimento

### Executar localmente (sem Docker)

1. **Inicie apenas o banco de dados:**
   ```bash
   docker-compose up db -d
   ```

2. **Configure o `.env` para desenvolvimento local:**
   ```bash
   DB_HOST=localhost
   # ... outras configura√ß√µes
   ```

3. **Execute a aplica√ß√£o:**
   ```bash
   go run cmd/api/main.go
   ```

### Comandos √∫teis do Docker

```bash
# Ver logs em tempo real
docker-compose logs -f api

# Parar todos os servi√ßos
docker-compose down

# Reconstruir apenas a API
docker-compose build api && docker-compose up -d api

# Acessar o container da API
docker-compose exec api sh

# Acessar o banco de dados
docker-compose exec db psql -U postgres -d mystery_gifter
```

### Comandos √∫teis do Makefile

```bash
# Ver todos os comandos dispon√≠veis
make help

# Gerar documenta√ß√£o Swagger
make generate-docs

# Servir documenta√ß√£o Swagger
make serve-docs

# Executar testes
make test

# Compilar a aplica√ß√£o
make build

# Executar a aplica√ß√£o localmente
make run

# Instalar ferramentas necess√°rias
make install-tools
```

## üß™ Testes

```bash
# Executar todos os testes
make test

# Ou usando go diretamente
go test ./...

# Executar testes com cobertura
go test -cover ./...

# Executar testes de um pacote espec√≠fico
go test ./internal/domain/...

# Executar testes com verbose
go test -v ./...
```

## üìÅ Estrutura do Projeto

```
mystery-gifter-api/
‚îú‚îÄ‚îÄ üìÅ cmd/api/                    # Ponto de entrada da aplica√ß√£o
‚îú‚îÄ‚îÄ üìÅ internal/
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ application/            # Camada de aplica√ß√£o (casos de uso)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ domain/                 # Camada de dom√≠nio (entidades e regras)
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ infra/                  # Camada de infraestrutura
‚îÇ       ‚îú‚îÄ‚îÄ üìÅ config/             # Configura√ß√µes
‚îÇ       ‚îú‚îÄ‚îÄ üìÅ entrypoint/         # Controllers REST e rotas
‚îÇ       ‚îî‚îÄ‚îÄ üìÅ outgoing/          # Reposit√≥rios e servi√ßos externos
‚îú‚îÄ‚îÄ üìÅ pkg/                       # Pacotes reutiliz√°veis
‚îú‚îÄ‚îÄ üìÅ test/                      # Utilit√°rios de teste
‚îú‚îÄ‚îÄ üìÅ docs/                      # Documenta√ß√£o Swagger
‚îú‚îÄ‚îÄ üê≥ docker-compose.yml         # Configura√ß√£o Docker Compose
‚îú‚îÄ‚îÄ üê≥ Dockerfile                 # Imagem Docker da aplica√ß√£o
‚îú‚îÄ‚îÄ üìÑ go.mod                     # Depend√™ncias Go
‚îî‚îÄ‚îÄ üìÑ README.md                  # Este arquivo
```

## ü§ù Contribui√ß√£o

Contribui√ß√µes s√£o bem-vindas! Para contribuir:

1. **Fork** o projeto
2. **Crie** uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. **Commit** suas mudan√ßas (`git commit -m 'Add some AmazingFeature'`)
4. **Push** para a branch (`git push origin feature/AmazingFeature`)
5. **Abra** um Pull Request

### Padr√µes de C√≥digo

- Siga as conven√ß√µes do Go
- Escreva testes para novas funcionalidades
- Mantenha a cobertura de testes alta
- Documente mudan√ßas na API no Swagger
- Use commits sem√¢nticos

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

---

<div align="center">

**Desenvolvido com ‚ù§Ô∏è em Go**

[‚≠ê D√™ uma estrela](https://github.com/waliqueiroz/mystery-gifter-api) se este projeto te ajudou!

</div>
